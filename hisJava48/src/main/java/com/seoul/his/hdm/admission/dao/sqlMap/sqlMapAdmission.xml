<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seoul.his.hdm.admission.dao.InpatientDAO">
	<cache flushInterval="86400000" eviction="LRU" />

	<resultMap type="InpatientBean" id="Inpatient">
        <result property="outpaReceiptNo"  column="OUTPA_RECEIPT_NO" />      <!--외래접수번호   -->
        <result property="trmtDate"        column="TRMT_DATE" />             <!--진료일시       -->
        <result property="trmtDept"        column="TRMT_DEPT" />             <!--진료과코드   -->
        <result property="trmtDeptNm"      column="TRMT_DEPT_NM" />          <!--진료과명        -->
        <result property="trmtDoct"        column="TRMT_DOCT" />             <!--진료의사코드   -->
        <result property="trmtDoctNm"      column="TRMT_DOCT_NM" />          <!--진료의사명     -->
        <result property="hosptlzYb"       column="HOSPTLZ_YB" />            <!--입원여부       -->
        <result property="hosptlzRsvtYb"   column="HOSPTLZ_RSVT_YB" />       <!--입원예약여부   -->
        <result property="patType"         column="PAT_TYPE" />              <!--환자유형       -->
        <result property="trmtCostCalcuYb" column="TRMT_COST_CALCU_YB" />    <!--진찰료계산여부 -->
        <result property="trmtYb"          column="TRMT_YB" />               <!--진료여부       -->
        <result property="prescYb"         column="PRESC_YB" />              <!--처방여부       -->
        <result property="regDept"         column="REG_DEPT" />              <!--등록부서       -->
        <result property="cngDept"         column="CNG_DEPT" />              <!--변경부서       -->
        <result property="receiptDate"     column="RECEIPT_DATE" />          <!--접수날짜       -->
        <result property="dgnsNm"          column="DGNS_NM" />               <!--진단명         -->
        <result property="ntTtYb"          column="NT_TT_YB" />              <!--초/재진여부    -->
        <result property="expCd"           column="EXP_CD" />                <!--감면코드       -->
        <result property="expNm"           column="EXP_NM" />                <!--감면명         -->
        <result property="nwDiv"           column="NW_DIV" />                <!--내원구분       -->
        <result property="patNo"           column="PAT_NO" />                <!--환자등록번호   -->
        <result property="patNm"           column="PAT_NM" />                <!--환자이름       -->
    </resultMap>

    <select id="selectInpatientList" resultMap="Inpatient">
        SELECT
            P.PAT_NO,
            P.PAT_NM ,
            R.OUTPA_RECEIPT_NO,
            R.TRMT_DATE,
            R.TRMT_DEPT,
            FN_CM_CODE_DTL_NAME('GP080',R.TRMT_DEPT) AS TRMT_DEPT_NM,
            R.TRMT_DOCT,
            FN_HM_EMP(R.TRMT_DOCT) AS TRMT_DOCT_NM,
            R.HOSPTLZ_YB ,
            R.HOSPTLZ_RSVT_YB,
            R.PAT_TYPE ,
            R.TRMT_COST_CALCU_YB,
            R.TRMT_YB ,
            R.PRESC_YB ,
            R.REG_DEPT ,
            R.CNG_DEPT ,
            R.RECEIPT_DATE,
            R.DGNS_NM,
            R.NT_TT_YB,
            R.EXP_CD,
            FN_CM_CODE_DTL_NAME('MD001',R.EXP_CD) AS EXP_NM,
            R.NW_DIV
        FROM
            WS_OUTPA_RECEIPT R
        ,   WS_PAT P
        WHERE R.PAT_NO=P.PAT_NO
        AND R.HOSPTLZ_YB='Y'
            <if test="patNo != '' and patNo != null">
                AND R.pat_no=#{patNo}
            </if>
            <if test="trmtDoct != '' and trmtDoct != null">
                AND R.trmt_doct=#{trmtDoct}
            </if>
            <if test="trmtDate != '' and trmtDate != null">
                AND R.trmt_date=#{trmtDate}
            </if>
            <if test="gubun != '' and gubun !=null">
                AND HOSPTLZ_YB=#{gubun}
            </if>
        ORDER BY R.OUTPA_RECEIPT_NO
    </select>
</mapper>